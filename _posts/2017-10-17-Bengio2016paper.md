I was reading the paper written by Taesup Kim and Yoshua Bengio] (2016) named *Deep Directed Generative Models with Energy-Based Probability Estimation*. [https://arxiv.org/abs/1606.03439](arXiv:1606.03439) 

$$
P_{\mathrm{\Theta}}(\mathrm{x})= \frac{e^{-E_{\mathrm{\Theta}}(\mathrm{x})}}{Z_{\mathrm{\Theta}}}
$$


$$
Z_{\mathrm{\Theta}}=\sum_{\mathrm{x}}e^{-E_{\mathrm{\Theta}}(\mathrm{x})}
$$

$$
\begin{align*}
\frac{\partial\mathcal{L}(\mathrm{\Theta}, \mathcal{D}')}{\partial \mathrm{\Theta}} & = -\frac{1}{N}\sum_{i=1}^{N}\frac{\partial\log P_{\mathrm{\Theta}}(\mathrm{x}^{(i)})}{\partial\mathrm{\Theta}}\\
&=-\frac{1}{N}\sum_{i=1}^{N}\frac{\partial\log \frac{e^{-E_{\mathrm{\Theta}}(\mathrm{x}^{(i)})}}{Z_{\mathrm{\Theta}}}}{\partial\mathrm{\Theta}}\\
&=\frac{1}{N}\sum_{i=1}^{N}\frac{\partial E_{\mathrm{\Theta}}(\mathrm{x}^{(i)})}{\partial\mathrm{\Theta}} + \frac{1}{N}\sum_{i=1}^{N}\frac{\partial \log Z_{\mathrm{\Theta}}}{\partial \mathrm{\Theta}} \\
&=\frac{1}{N}\sum_{i=1}^{N}\frac{\partial E_{\mathrm{\Theta}}(\mathrm{x}^{(i)})}{\partial\mathrm{\Theta}} + \frac{\partial \log Z_{\mathrm{\Theta}}}{\partial \mathrm{\Theta}}\\
&=\frac{1}{N}\sum_{i=1}^{N}\frac{\partial E_{\mathrm{\Theta}}(\mathrm{x}^{(i)})}{\partial\mathrm{\Theta}} + \frac{\partial \log\sum_{i=1}^{N}e^{-E_{\mathrm{\Theta}}(\mathrm{x}^{(i)})}}{\partial \mathrm{\Theta}} \\
&=\frac{1}{N}\sum_{i=1}^{N}\frac{\partial E_{\mathrm{\Theta}}(\mathrm{x}^{(i)})}{\partial\mathrm{\Theta}} +  \frac{1}{\sum_{i=1}^{N}e^{-E_{\mathrm{\Theta}}(\mathrm{x}^{(i)})}}\frac{\partial \sum_{i=1}^{N}e^{-E_{\mathrm{\Theta}}(\mathrm{x}^{(i)})}}{\partial \mathrm{\Theta}} \\
&=\frac{1}{N}\sum_{i=1}^{N}\frac{\partial E_{\mathrm{\Theta}}(\mathrm{x}^{(i)})}{\partial\mathrm{\Theta}} +  \frac{\sum_{i=1}^{N}e^{-E_{\mathrm{\Theta}}(\mathrm{x}^{(i)})}\frac{-\partial E_{\mathrm{\Theta}}(\mathrm{x}^{(i)})}{\partial\mathrm{\Theta}}}{\sum_{i=1}^{N}e^{-E_{\mathrm{\Theta}}(\mathrm{x}^{(i)})}}  \\
&=\frac{1}{N}\sum_{i=1}^{N}\frac{\partial E_{\mathrm{\Theta}}(\mathrm{x}^{(i)})}{\partial\mathrm{\Theta}} - \sum_{i=1}^{N}\frac{e^{-E_{\mathrm{\Theta}}(\mathrm{x}^{(i)})}}{Z_{\mathrm{\Theta}}}\frac{\partial E_{\mathrm{\Theta}}(\mathrm{x}^{(i)})}{\partial \mathrm{\Theta}}\\
&=\frac{1}{N}\sum_{i=1}^{N}\frac{\partial E_{\mathrm{\Theta}}(\mathrm{x}^{(i)})}{\partial\mathrm{\Theta}} - \sum_{i=1}^{N}P_{\mathrm{\Theta}}(\mathrm{x}^{(i)})\frac{\partial E_{\mathrm{\Theta}}(\mathrm{x}^{(i)})}{\partial \mathrm{\Theta}}\\
&=\frac{1}{N}\sum_{i=1}^{N}\frac{\partial E_{\mathrm{\Theta}}(\mathrm{x}^{(i)})}{\partial\mathrm{\Theta}} - E_{\mathrm{x}\sim P_{\mathrm{\Theta}(\mathrm{x})}}\left[\frac{\partial E_{\mathrm{\Theta}}(\mathrm{x})}{\partial \mathrm{\Theta}} \right]
\end{align*}

$$
